{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Movies Directory</h2>
    
    <form class="d-flex" method="GET" action="/movies">
        <input class="form-control me-2 bg-dark text-light border-secondary" type="search" name="q" value="{{ search_query }}" placeholder="Search titles..." aria-label="Search">
        <button class="btn btn-outline-primary" type="submit">Search</button>
        {% if search_query %}
            <a href="/movies" class="btn btn-outline-secondary ms-2">Clear</a>
        {% endif %}
    </form>
</div>

<div class="card shadow-sm mb-4">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0 align-middle">
                <thead>
                    <tr>
                        <th class="ps-4">ID</th>
                        <th>Poster</th>
                        <th>Title</th>
                        <th>Release Year</th>
                        <th>Rating</th>
                        <th class="text-end pe-4">Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for movie in movies %}
                    <tr style="cursor: pointer;" onclick="window.location='/movie/{{ movie.id }}'">
                        <td class="ps-4">{{ movie.id }}</td>
                        <td>
                            {% if movie.poster_url %}
                            <img src="{{ movie.poster_url }}" alt="Poster" class="rounded" style="height: 50px; width: auto; object-fit: cover;">
                            {% else %}
                            <div class="bg-secondary rounded d-flex align-items-center justify-content-center text-white" style="height: 50px; width: 35px; font-size: 0.7rem;">N/A</div>
                            {% endif %}
                        </td>
                        <td>
                            <strong>{{ movie.title }}</strong><br>
                            <small class="text-muted">{{ movie.original_title }}</small>
                        </td>
                        <td>{{ movie.release_date[:4] if movie.release_date else 'N/A' }}</td>
                        <td><span class="badge bg-primary">{{ movie.rating }}</span></td>
                        <td class="text-end pe-4">
                            <a href="/movie/{{ movie.id }}" class="btn btn-sm btn-outline-light">Details</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="text-center py-4">No movies found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Pagination -->
{% if total_pages > 1 %}
<nav aria-label="Movies pagination">
  <ul class="pagination justify-content-center">
    <li class="page-item {% if page == 1 %}disabled{% endif %}">
      <a class="page-link bg-dark text-light border-secondary" href="?q={{ search_query }}&page={{ page - 1 }}">Previous</a>
    </li>
    
    <li class="page-item disabled">
      <span class="page-link bg-dark text-muted border-secondary">Page {{ page }} of {{ total_pages }}</span>
    </li>
    
    <li class="page-item {% if page == total_pages %}disabled{% endif %}">
      <a class="page-link bg-dark text-light border-secondary" href="?q={{ search_query }}&page={{ page + 1 }}">Next</a>
    </li>
  </ul>
</nav>
{% endif %}

{% endblock %}
